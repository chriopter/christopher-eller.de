{{ define "main" }}
<div class="places-section">
    <!-- Full Viewport Map -->
    <div class="map-container" id="places-map"></div>
    
    <!-- Menu Pill -->
    <div class="menu-pill" id="menu-pill">
        {{ partial "header.html" . }}
    </div>
    
    <!-- Unified Side Panel -->
    <div class="side-panel" id="side-panel">
        <!-- Panel toggle button -->
        <div class="panel-hide-toggle" id="panel-hide-toggle" title="Hide Panel">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"></path>
            </svg>
        </div>

        <!-- Back Button -->
        <div class="place-detail-header">
            <button class="back-button" onclick="window.location.href='/places/'">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5"></path>
                    <path d="M12 19l-7-7 7-7"></path>
                </svg>
                Back to list
            </button>
        </div>

        <!-- Place Content -->
        <article class="place-detail">
            <header class="place-header">
                <h1>{{ .Title }}</h1>
                {{ with .Description }}<p class="place-description">{{ . }}</p>{{ end }}
            </header>

            <!-- Tags -->
            {{ with .Params.tags }}
            <div class="place-tags">
                {{ range . }}<span class="tag">{{ . }}</span>{{ end }}
            </div>
            {{ end }}

            <!-- Website Link -->
            {{ with .Params.urls }}
            <div class="place-links">
                <a href="{{ . }}" class="website-link" target="_blank" rel="noopener noreferrer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                    Visit Website
                </a>
            </div>
            {{ end }}

            <!-- Main Content -->
            <div class="place-body">
                {{ .Content }}
            </div>

            <!-- Images -->
            {{ with .Resources.ByType "image" }}
            <div class="place-images">
                {{ range . }}
                <img src="{{ .RelPermalink }}" alt="{{ .Name }}" loading="lazy">
                {{ end }}
            </div>
            {{ end }}
        </article>
    </div>

    
    <!-- Mobile Toggle Button -->
    <div class="panel-toggle" id="panel-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </div>
    
    <!-- Show Panel Button -->
    <div class="panel-show-toggle hidden" id="panel-show-toggle" title="Show Panel">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"></path>
        </svg>
    </div>
</div>

<!-- Load CSS -->
<link rel="stylesheet" href="/places/node_modules/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="/places/css/main.css">

<!-- Load JavaScript -->
<script src="/places/node_modules/leaflet/dist/leaflet.js"></script>
<script type="module">
document.addEventListener('DOMContentLoaded', function() {
    const placeData = {
        lat: parseFloat("{{ .Params.lat }}"),
        lng: parseFloat("{{ .Params.lng }}"),
        title: "{{ .Title }}"
    };

    // Initialize map
    const map = L.map('places-map').setView([placeData.lat, placeData.lng], 13);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
    
    L.marker([placeData.lat, placeData.lng])
        .bindPopup(placeData.title)
        .addTo(map);

    // Panel toggle functionality
    const panel = document.getElementById('side-panel');
    const toggleBtn = document.getElementById('panel-toggle');
    const showPanelBtn = document.getElementById('panel-show-toggle');
    const hidePanelBtn = document.getElementById('panel-hide-toggle');

    function togglePanel() {
        panel.classList.toggle('hidden');
        showPanelBtn.classList.toggle('hidden');
    }

    toggleBtn.addEventListener('click', togglePanel);
    showPanelBtn.addEventListener('click', togglePanel);
    hidePanelBtn.addEventListener('click', togglePanel);
});
</script>
{{ end }}
