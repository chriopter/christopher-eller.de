{{ define "main" }}
<div class="places-section">
    <!-- Menu indicator for sliding in the header -->
    <div class="menu-indicator" id="menu-indicator"></div>
    
    <!-- Full Viewport Map -->
    <div class="map-container" id="places-map"></div>
    
    <!-- Unified Side Panel with Search, Filters and List -->
    <div class="side-panel" id="side-panel">
        <!-- Side panel toggle button -->
        <div class="panel-hide-toggle" id="panel-hide-toggle" title="Hide Panel">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"></path>
            </svg>
        </div>
        <header class="side-panel-header">
            <h1>{{ .Title }}</h1>
            {{ with .Description }}<p>{{ . }}</p>{{ end }}
        </header>
        
        <div class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="Search places...">
        </div>
        
        <div class="tag-filters" id="tag-filters">
            <!-- Tags will be dynamically added here by JavaScript -->
        </div>
        
        <div class="places-list" id="places-list">
            <!-- Places list will be dynamically generated -->
        </div>
        
        <div class="view-controls">
            <span id="map-view" class="view-control active" title="Map View">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                    <line x1="8" y1="2" x2="8" y2="18"></line>
                    <line x1="16" y1="6" x2="16" y2="22"></line>
                </svg>
            </span>
            <span id="list-view" class="view-control" title="List View">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
            </span>
        </div>
    </div>
    
    <!-- Mobile Toggle Button -->
    <div class="panel-toggle" id="panel-toggle">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </div>
    
    <!-- Show Panel Button (visible when panel is hidden) -->
    <div class="panel-show-toggle hidden" id="panel-show-toggle" title="Show Panel">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"></path>
        </svg>
    </div>

    <!-- Hidden data container for JavaScript -->
    <script type="application/json" id="places-data">
        [
            {{ $first := true }}
            {{ range .Pages }}
                {{ if $first }}{{ $first = false }}{{ else }},{{ end }}
                {
                    "title": {{ .Title | jsonify }},
                    "description": {{ .Params.description | jsonify }},
                    "lat": {{ .Params.lat }},
                    "lng": {{ .Params.lng }},
                    "tags": {{ .Params.tags | jsonify }},
                    "permalink": "{{ .RelPermalink }}"
                }
            {{ end }}
        ]
    </script>
</div>

<!-- Load CSS and JavaScript -->
<link rel="stylesheet" href="/places/node_modules/leaflet/dist/leaflet.css">
<link rel="stylesheet" href="/places/css/places.css">
<script src="/places/node_modules/leaflet/dist/leaflet.js"></script>
<script src="/places/js/places.js"></script>

<!-- Header toggle script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const header = document.querySelector('header');
        const menuIndicator = document.getElementById('menu-indicator');
        
        // Toggle menu on indicator click
        menuIndicator.addEventListener('click', function() {
            header.classList.toggle('visible');
        });
        
        // Show menu when indicator is hovered
        menuIndicator.addEventListener('mouseenter', function() {
            header.classList.add('visible');
        });
        
        // Hide menu when mouse leaves header area
        header.addEventListener('mouseleave', function(e) {
            // Only hide if we're not moving to the menu indicator
            if (!e.relatedTarget || e.relatedTarget.id !== 'menu-indicator') {
                header.classList.remove('visible');
            }
        });
    });
</script>
{{ end }}
