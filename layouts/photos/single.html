{{ define "main" }}
<style>
/* Override main content width for photo pages */
main {
    max-width: 1400px !important;
}

/* Force dark mode styles regardless of theme */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #000 !important;
    color: #eee !important;
}

header {
    display: none !important;
}

.site-title,
.nav-links a {
    color: #eee !important;
}

footer {
    display: none !important;
}

footer a {
    color: #999 !important;
}

main {
    padding-top: 0 !important;
}


.photo-container {
    max-width: 100vw;
    margin: 0 auto;
    box-sizing: border-box;
    padding: 0;
    display: flex;
    align-items: center;
    min-height: 100vh;
}

.photo-main {
    display: grid;
    grid-template-columns: 1fr;
    gap: 36px;
    margin: 0;
    align-items: center;
    width: 100%;
    min-height: 100vh;
}

@media (min-width: 1200px) {
    .photo-main {
        grid-template-columns: minmax(0, 3fr) minmax(350px, 1.1fr);
        gap: 48px;
        padding: 40px 60px;
    }
}

.photo-main img {
    width: 100%;
    max-height: 85vh;
    object-fit: contain;
}

.photo-main > div:first-child {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 0 40px 24px;
    box-sizing: border-box;
}

.photo-hero {
    flex: 1;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 0;
}
.photo-hero img { max-height: calc(90vh - 140px); }

@media (min-width: 1200px) {
    .photo-main img {
        max-height: 85vh;
    }
}

@media (max-width: 1199px) { .photo-main img { max-height: none; margin: 10px 0; } }

.photo-info {
    position: static;
    text-align: left;
    padding: 0 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 18px;
    align-self: center;
    max-height: 85vh;
    overflow-y: auto;
}

@media (max-width: 1199px) {
    html, body { overflow: auto; height: auto; }
    .photo-info { text-align: center; padding: 10px 16px; gap: 12px; max-height: none; overflow: visible; }
    .photo-main { padding: 10px 10px 16px; gap: 10px; }
    .photo-main > div:first-child { padding: 0 16px 16px; }
    .photo-hero { padding: 0 16px; }
    .photo-strip { padding: 0 16px; }
    .photo-strip img { height: 60vh; }
    .photo-nav.prev, .photo-nav.next { position: static; transform: none; }
}

.photo-title {
    font-size: 24px;
    margin-bottom: 10px;
}

.photo-date {
    color: #999;
    margin-bottom: 32px;
    font-size: 15px;
}

.photo-metadata {
    font-size: 14px;
    color: #999;
}

.photo-metadata p {
    margin: 5px 0;
}

.back-to-gallery {
    display: block;
    margin-bottom: 20px;
    color: #999;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.3s ease;
    opacity: 0.7;
}

.back-to-gallery:hover {
    color: #fff;
}

.photo-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    color: #fff;
    text-decoration: none;
    padding: 15px;
    border-radius: 5px;
    transition: opacity 0.2s ease;
    display: flex;
    align-items: center;
    z-index: 10;
}

.photo-nav:hover { opacity: 0.8; }

.nav-container {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transform: translateY(-50%);
    pointer-events: none;
}

.nav-container .photo-nav { pointer-events: auto; }

.photo-nav.prev { position: fixed; left: 20px; transform: translateY(-50%); }
.photo-nav.next { position: fixed; right: 20px; transform: translateY(-50%); }

.photo-nav-arrow {
    font-size: 24px;
}

@media (max-width: 1199px) {
    .photo-container {
        flex-direction: column;
        align-items: center;
        padding: 20px 0 100px;
    }

    .photo-nav {
        position: relative;
        top: auto;
        left: auto;
        right: auto;
        transform: none;
        margin: 0;
        display: inline-block;
        padding: 12px;
        min-width: 44px;
        text-align: center;
        background: transparent;
        backdrop-filter: none;
    }

    .photo-main {
        padding: 20px 15px 60px;
        gap: 20px;
    }

    .nav-container { position: static; background: transparent; backdrop-filter: none; padding: 0 12px; margin: 0; display: flex; justify-content: space-between; align-items: center; width: 100%; }

    .nav-container:empty {
        display: none;
    }

    .nav-container:has(.photo-nav:only-child) {
        justify-content: flex-end;
    }

    .nav-container:has(.photo-nav.prev:only-child) {
        justify-content: flex-start;
    }
}

@media (max-width: 768px) {
    .photo-nav { padding: 8px; }
    .photo-nav-arrow { font-size: 20px; }
}

.full-size-link {
    display: inline-block;
    margin-top: 15px;
    color: #999;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.3s ease;
}

.full-size-link:hover {
    color: #fff;
}

/* Horizontal strip for multi-image posts */
.photo-strip { display: flex; gap: 16px; overflow-x: auto; padding: 0 40px; scroll-snap-type: x mandatory; align-items: center; }
.photo-strip .strip-item { flex: 0 0 auto; scroll-snap-align: center; }
.photo-strip img { height: 85vh; width: auto; object-fit: contain; display: block; }

.photo-extras { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; width: 100%; margin: 8px 0 0; }

@media (max-width: 900px) { .photo-extras { grid-template-columns: repeat(2, minmax(0, 1fr)); } }

@media (max-width: 560px) { .photo-extras { grid-template-columns: 1fr; } }

.photo-extra { display: block; border-radius: 8px; overflow: hidden; height: 110px; }

.photo-extra img { width: 100%; height: 100%; object-fit: cover; display: block; }
</style>

{{ $currentPage := . }}
{{/* Build EXIF for inline mobile use as well */}}
{{ $photos := where .Site.RegularPages "Section" "photos" }}
{{ range $index, $page := $photos }}
    {{ if eq $page $currentPage }}
        {{ $prevIndex := sub $index 1 }}
        {{ $nextIndex := add $index 1 }}
        {{ with $photos }}
            {{ if ge $prevIndex 0 }}
                {{ $prevPage := index . $prevIndex }}
                {{ $.Scratch.Set "prevPage" $prevPage }}
            {{ end }}
            {{ if lt $nextIndex (len .) }}
                {{ $nextPage := index . $nextIndex }}
                {{ $.Scratch.Set "nextPage" $nextPage }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}

<div class="photo-container">
    <div class="photo-main" id="photo-main">
        <div>
            {{ $images := .Resources.Match "*.{jpg,jpeg,png,gif,heic,heif}" }}
            {{ if gt (len $images) 1 }}
            {{/* Multi-image: horizontal strip with all pictures */}}
            <div class="photo-strip">
                {{ range $images }}
                    {{ $img := . }}
                    {{ if eq $img.MediaType.MainType "image" }}
                        {{ $display := $img }}
                        {{ if not (or (eq $img.MediaType.SubType "heif") (eq $img.MediaType.SubType "heic")) }}
                            {{ $display = $img.Resize "1600x" }}
                        {{ end }}
                        {{ with $img.Exif }}{{ $.Scratch.Set "exif" . }}{{ end }}
                        <a class="strip-item photo-item" href="{{ $img.RelPermalink }}" target="_blank">
                            <img src="{{ $display.RelPermalink }}" alt="{{ $currentPage.Title }}" loading="lazy" />
                        </a>
                    {{ end }}
                {{ end }}
            </div>
            {{ else }}
            {{/* Single image: classic hero */}}
            <div class="photo-hero">
                {{ range first 1 $images }}
                    {{ $image := . }}
                    {{ if eq $image.MediaType.MainType "image" }}
                        {{ with $image.Exif }}{{ $.Scratch.Set "exif" . }}{{ end }}
                        {{ $hero := $image }}
                        {{ if not (or (eq $image.MediaType.SubType "heif") (eq $image.MediaType.SubType "heic")) }}
                            {{ $hero = $image.Resize "1600x" }}
                        {{ end }}
                        <a href="{{ $image.RelPermalink }}" class="photo-item" target="_blank">
                            <img src="{{ $hero.RelPermalink }}" alt="{{ $currentPage.Title }}" loading="eager" />
                        </a>
                    {{ end }}
                {{ end }}
            </div>
            {{ end }}
            
            <div class="nav-container">
                {{ with $.Scratch.Get "prevPage" }}
                <a href="{{ .RelPermalink }}" class="photo-nav prev" title="{{ .Title }}">
                    <span class="photo-nav-arrow">‚Üê</span>
                </a>
                {{ end }}
                
                {{ with $.Scratch.Get "nextPage" }}
                <a href="{{ .RelPermalink }}" class="photo-nav next" title="{{ .Title }}">
                    <span class="photo-nav-arrow">‚Üí</span>
                </a>
                {{ end }}
            </div>

            {{/* extras shown under hero (left column) */}}
            {{/* duplicate extras removed */}}
            {{ if gt (len $images) 1 }}
            <div class="photo-extras">
                {{ range $i, $extra := after 1 $images }}
                    {{ if lt $i 3 }}
                        {{ if eq $extra.MediaType.MainType "image" }}
                            {{ $thumb := $extra }}
                            {{ if not (or (eq $extra.MediaType.SubType "heif") (eq $extra.MediaType.SubType "heic")) }}
                                {{ $thumb = $extra.Fill "400x400 smart" }}
                            {{ end }}
                            <a href="{{ $extra.RelPermalink }}" class="photo-extra" target="_blank">
                                <img src="{{ $thumb.RelPermalink }}" alt="{{ $.Title }}" loading="lazy" />
                            </a>
                        {{ end }}
                    {{ end }}
                {{ end }}
            </div>
            {{ end }}
        </div>
        
        <div class="photo-info">
            <a href="/photos" class="back-to-gallery">‚Üê Back to Gallery</a>
            <h1 class="photo-title">{{ .Title }}</h1>
            {{ $exif := $.Scratch.Get "exif" }}
            {{ if $exif }}
                {{ with $exif.Tags.DateTimeOriginal }}
                    {{ $dateStr := . }}
                    {{ $dateStr := replaceRE "^([0-9]{4}):([0-9]{2}):([0-9]{2})" "$1-$2-$3" $dateStr }}
                    {{ $dateStr := replaceRE ":([0-9]{2}):([0-9]{2})" " $1:$2" $dateStr }}
                    {{ $dateStr := replaceRE " ([0-9]{2}) ([0-9]{2}):([0-9]{2})" " $1:$2:$3" $dateStr }}
                    {{ $parsedDate := time $dateStr }}
                    <div class="photo-date">{{ $parsedDate.Format "2. January 2006" }}</div>
                {{ end }}
            {{ end }}
            <div class="photo-metadata">
                {{ if $exif }}
                    {{ with $exif.Tags.Model }}
                    <p>üì∑ {{ . }}</p>
                    {{ end }}
                    
                    {{ with $exif.Tags.LensModel }}
                    <p>üî≠ {{ if $exif.Tags.Model }}{{ replaceRE (printf "%s ?(.+)" $exif.Tags.Model) "$1" . }}{{ else }}{{ . }}{{ end }}</p>
                    {{ end }}
                    
                    <p>‚öôÔ∏è {{ with $exif.Tags.FocalLength }}{{ $focalNum := float . }}{{ printf "%.0f" $focalNum }}mm{{ with $exif.Tags.FocalLengthIn35mmFormat }} ({{ . }}mm){{ end }}{{ end }}{{ with $exif.Tags.FNumber }}{{ $fnum := . }}{{ $fnumFloat := float $fnum }} ‚Ä¢ ∆í/{{ printf "%.1f" $fnumFloat }}{{ end }}{{ with $exif.Tags.ExposureTime }}{{ if . }}{{ $parts := split . "/" }}{{ if eq (len $parts) 2 }}{{ $numerator := index $parts 0 }}{{ $denominator := index $parts 1 }}{{ $denominator := div (float $denominator) (float $numerator) }}{{ $roundedDenominator := math.Round $denominator }} ‚Ä¢ 1/{{ $roundedDenominator }}s{{ else }} ‚Ä¢ {{ . }}s{{ end }}{{ end }}{{ end }}{{ with $exif.Tags.ISO }} ‚Ä¢ ISO {{ . }}{{ else }}{{ with $exif.Tags.ISOSpeedRatings }} ‚Ä¢ ISO {{ . }}{{ end }}{{ end }}
                    </p>
                {{ end }}
                
                <p style="margin-top: 15px; font-size: 12px; opacity: 0.7;">Uploaded on {{ .Date.Format "2. January 2006" }}</p>
            </div>

            {{/* extras moved under hero (left column) */}}

            {{ range first 1 $images }}
            <a href="{{ .RelPermalink }}" class="full-size-link" target="_blank">View Full Size ‚Üó</a>
            {{ end }}
            </div>
        </div>
</div>

<script>
// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft') {
        const prevLink = document.querySelector('.photo-nav.prev');
        if (prevLink) window.location.href = prevLink.href;
    }
    if (e.key === 'ArrowRight') {
        const nextLink = document.querySelector('.photo-nav.next');
        if (nextLink) window.location.href = nextLink.href;
    }
});

// Basic swipe navigation on touch devices
(function() {
  let startX = 0, startY = 0, startTime = 0;
  const threshold = 50; // px
  const restraint = 80; // allow some vertical movement
  const allowedTime = 500; // ms

  window.addEventListener('touchstart', function(e) {
    const t = e.changedTouches[0];
    startX = t.pageX; startY = t.pageY; startTime = Date.now();
  }, { passive: true });

  window.addEventListener('touchend', function(e) {
    const t = e.changedTouches[0];
    const distX = t.pageX - startX;
    const distY = t.pageY - startY;
    const elapsed = Date.now() - startTime;
    if (elapsed <= allowedTime && Math.abs(distX) >= threshold && Math.abs(distY) <= restraint) {
      if (distX < 0) {
        const nextLink = document.querySelector('.photo-nav.next');
        if (nextLink) window.location.href = nextLink.href;
      } else {
        const prevLink = document.querySelector('.photo-nav.prev');
        if (prevLink) window.location.href = prevLink.href;
      }
    }
  }, { passive: true });
})();
</script>
{{ end }}
